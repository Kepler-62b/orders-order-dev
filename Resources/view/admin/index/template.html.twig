{% trans_default_domain('admin.order') %}

{# ---- ШАБЛОН ------------------------------------------------------------ #}
{% extends Template('/admin/base.html.twig') %}

 {% block title %}{{ 'admin.page.control'|trans }}{% endblock %}

{# ---- CSS ------------------------------------------------------------ #}
 {% block stylesheets %}
     <link href="/assets/plugins/draggable/draggable.min.css" rel="stylesheet" type="text/css">
     <link href="/assets/plugins/nice-select2/nice-select2.min.css" rel="stylesheet" type="text/css">
 {% endblock %}


{# ---- КОНТЕНТ-БЛОК ------------------------------------------------------------ #}
{% block content %}
    {{ include(_self|replace({ "template.html.twig": baks_settings.device~"/content.html.twig" })) }}
{% endblock %}



 {% block javascript %}



 {#<script nonce="{{ csp_nonce() }}" data-src="/assets/order_orders/orders_basket.min.js?v={{ version }}" class='lazy'></script>
 <script nonce="{{ csp_nonce() }}" data-src="/assets/order_orders/orders_package.min.js?v={{ version }}" class='lazy'></script>#}

 <script async nonce="{{ csp_nonce() }}" class="lazy" data-src="/assets/plugins/draggable/draggable.bundle.min.js?v={{ version }}" ></script>
 <script async nonce="{{ csp_nonce() }}" class="lazy" data-src="/assets/plugins/nice-select2/nice-select2.min.js?v={{ version }}" ></script>

<script nonce="{{ csp_nonce() }}" data-src="/assets/order_orders/order_draggable.min.js?v={{ version }}" class='lazy'></script>

{% if baks_profile.id is defined %}



 <script nonce="{{ csp_nonce() }}" data-src="https://unpkg.com/centrifuge@3.1.1/dist/centrifuge.js" class='lazy'></script>

<script nonce="{{ csp_nonce() }}">

/** Сокеты */
setTimeout(function xA1wFjaW7B() {

    if (typeof Centrifuge === 'function') {
        centrifuge = new Centrifuge("wss://{{ centrifugo_dsn }}/connection/websocket",
            {
                token: "{{ token }}",
                getToken: function (ctx) {
                    return getToken('/centrifugo/credentials/user', ctx);
                },
                debug: true,
            });

        const publish = centrifuge.newSubscription('orders');

        publish.on('publication', function (ctx) {

            if (ctx.data.profile !== '{{ baks_profile.id }}')
                        {
                /* Удаляем у остальных менеджеров заказ */
                document.getElementById(ctx.data.order).remove();
                //console.log(ctx.data);
            }

        }).subscribe();

        centrifuge.connect();
        return;
    }

    setTimeout(xA1wFjaW7B, 100);

}, 100);
</script>

{% endif %}

 {% endblock %}

