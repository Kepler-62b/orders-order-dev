{% trans_default_domain('admin.order') %}

{# ---- ШАБЛОН ------------------------------------------------------------ #}
{% extends Template('/admin/base.html.twig') %}

 {% block title %}{{ 'admin.page.control'|trans }}{% endblock %}

{# ---- CSS ------------------------------------------------------------ #}
 {% block stylesheets %}
     <link href="/assets/plugins/draggable/draggable.min.css" rel="stylesheet" type="text/css">
     <link href="/assets/plugins/nice-select2/nice-select2.min.css" rel="stylesheet" type="text/css">
 {% endblock %}


{# ---- КОНТЕНТ-БЛОК ------------------------------------------------------------ #}
{% block content %}
    {{ include(_self|replace({ "template.html.twig": baks_settings.device~"/content.html.twig" })) }}
{% endblock %}



 {% block javascript %}


 <script nonce="{{ csp_nonce() }}" data-src="https://unpkg.com/centrifuge@3.1.1/dist/centrifuge.js" class='lazy'></script>

 {#<script nonce="{{ csp_nonce() }}" data-src="/assets/order_orders/orders_basket{{ app.environment != 'dev'?'.min' }}.js?v={{ version }}" class='lazy'></script>
 <script nonce="{{ csp_nonce() }}" data-src="/assets/order_orders/orders_package{{ app.environment != 'dev'?'.min' }}.js?v={{ version }}" class='lazy'></script>#}

 <script async nonce="{{ csp_nonce() }}" class="lazy" data-src="/assets/plugins/draggable/draggable.bundle.min.js?v={{ version }}" ></script>
 <script async nonce="{{ csp_nonce() }}" class="lazy" data-src="/assets/plugins/nice-select2/nice-select2.min.js?v={{ version }}" ></script>

<script nonce="{{ csp_nonce() }}" data-src="/assets/order_orders/order_draggable{{ app.environment != 'dev'?'.min' }}.js?v={{ version }}" class='lazy'></script>
<script nonce="{{ csp_nonce() }}">



/** Сокеты */
setTimeout(function xA1wFjaW7B() {

    if (typeof Centrifuge === 'function') {
        centrifuge = new Centrifuge("wss://{{ centrifugo_dsn }}/connection/websocket",
            {
                token: "{{ token }}", //"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIwMTg2NWMxMC1jZDQ1LTdmMjEtYTUxNi0wMDM5NDFiMWM0Y2IiLCJpZCI6IjAxODY2ZjllLTcwZDAtNzNlMC1iNzYzLTg3OTRiNmU2YjFjYiIsImV2ZW50IjoiMDE4NzJjZjEtMDhjNy03NTUzLWJmMjctOTQxNTVhOTMxYjZhIiwiZXhwIjoxNjgyOTYyMzY3fQ.IeIMimmMTn2W4leLQAR3O8T70LOVaWau3B-HXHwOdzM",
                getToken: function (ctx) {
                    return getToken('/centrifugo/credentials/user', ctx);
                },
                debug: true,
            });

        const publish = centrifuge.newSubscription('orders');

        publish.on('publication', function (ctx) {



            if (ctx.data.profile !== '{{ app.user.profile.id }}')
            {
                /* Удаляем у остальных менеджеров заказ */
                document.getElementById(ctx.data.order).remove();
                console.log(ctx.data);
            }
        }).subscribe();

        centrifuge.connect();
        return;
    }

    setTimeout(xA1wFjaW7B, 100);

}, 100);
</script>

 {% endblock %}

