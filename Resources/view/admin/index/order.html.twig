{% set id =  random() %}

<div class="draggable" data-order="{{ order.order_id }}" tabindex="0">
	
	<div class="border-bottom border-4 rounded-4"
			style="background-color: {{ color }}; border-color: {{ color }} !important;"
	>
		
		<div class="card bg-light-primary rounded-4">
			
			<div class="card-body d-flex justify-content-between small p-2">
				
				<div class="d-flex flex-column justify-content-between gap-2 offcanvas-link"
						data-href='{{ path('Orders:admin.detail', { id : order.order_id }) }}'
						data-id='{{ order.order_id }}'
{# 						data-bs-toggle="offcanvas" #}
{# 						data-bs-target="#offcanvas{{ order.order_id }}" #}
{# 						aria-controls="offcanvas{{ order.order_id }}" #}
						style="cursor: help"
				>
					
					<div class="small d-flex justify-content-between gap-2 lh-1">
						
						#{{ order.order_number }}
						
						{% if order.order_profile_discount %}
							<div class="small badge bg-danger rounded-1">-{{ order.order_profile_discount }}%</div>
						{% endif %}
						
					</div>
					
						<span class="fw-bolder d-flex justify-content-between align-items-center">
							
							{% set arr_price = order.product_price|json_decode %}
							
							{% set price = 0 %}
							
							{% for order_price in arr_price %}
								{% set price = order_price.price * order_price.total + price  %}
							{% endfor %}
							
							{#{% set price = order.order_price %}#}
							
							{% if order.order_profile_discount %}
								{% set price = price - (price / 100 * order.order_profile_discount) %}
							{% endif %}
							
							{#  Прибавляем стомиость доставки  #}
							{% set price = price + order.delivery_price %}
							
							<span class='h5 lh-1 '>{{ money(price, order.order_currency) }}</span>
							
						</span>
				</div>
				
				<div class="d-flex flex-column justify-content-between gap-1">
					
					<div class="text-end">
						<button type="button" class="btn btn-sm btn-light draggable-handle"
								aria-label="Изменить статус сделки">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
									class="bi bi-arrows-move" viewBox="0 0 16 16">
								<path fill-rule="evenodd"
										d="M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10zM.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708l-2-2zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8z" />
							</svg>
						</button>
					</div>
					
					<span class="small text-muted">{{ order.order_created|date('d.m.Y') }} </span>
				
				</div>
			
			</div>
			
			
			<div class="card-footer d-flex flex-column small gap-1 p-2">
				<span class="badge bg-light text-dark fw-bolder px-1 py-1 text-start">
					{{ order.order_profile }}
				</span>
				
				{% set users = order.order_user|json_decode %}
				
				{% for user in users %}
					<div class='{{ loop.first ? "fw-bolder" }}'>
						{{ user.profile_value|call_twig_func(user.profile_type~'_template') }}
					</div>
				{% endfor %}
				
			</div>
		</div>
	</div>
</div>

