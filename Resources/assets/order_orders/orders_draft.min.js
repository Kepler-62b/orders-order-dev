userProfileType=document.getElementById("new_order_form_usr_userProfile_type");if(userProfileType){userProfileType.addEventListener("change",function(event){let forms=this.closest("form");submitProfileForm(forms);return false})}document.querySelectorAll('input[name="new_order_form[usr][payment][payment]"]').forEach(function(userPayment){userPayment.addEventListener("change",function(event){let forms=this.closest("form");submitPaymentForm(forms);return false})});document.querySelectorAll('input[name="new_order_form[usr][delivery][delivery]"]').forEach(function(userPayment){userPayment.addEventListener("change",function(event){let forms=this.closest("form");submitDeliveryForm(forms);return false})});document.querySelectorAll("select.change_region_field").forEach(function(userRegion){userRegion.addEventListener("change",function(event){let forms=this.closest("form");submitRegionForm(forms,userRegion.id);return false})});async function submitDeliveryForm(forms){const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var doc=parser.parseFromString(data,"text/html");let user_delivery=doc.getElementById("user_delivery");document.getElementById("user_delivery").replaceWith(user_delivery);document.querySelectorAll('input[name="new_order_form[usr][delivery][delivery]"]').forEach(function(user_delivery){user_delivery.addEventListener("change",function(event){let forms=this.closest("form");submitDeliveryForm(forms);return false})});document.querySelectorAll("select.change_region_field").forEach(function(userRegion){userRegion.addEventListener("change",function(event){let forms=this.closest("form");submitRegionForm(forms,userRegion.id);return false})});var tooltipTriggerList=[].slice.call(user_delivery.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)});document.querySelectorAll(".js-datepicker").forEach(datepicker=>{let $elementDate=document.getElementById(datepicker.id).value;const[day,month,year]=$elementDate.split(".");$selectedDate=new Date(+year,month-1,+day);let currentDate=new Date;let nextDay=new Date(currentDate.setDate(currentDate.getDate()+1));currentDate=new Date;let limitDay=new Date(currentDate.setDate(currentDate.getDate()+7));MCDatepicker.create({el:"#"+datepicker.id,bodyType:"modal",autoClose:false,closeOndblclick:true,closeOnBlur:false,customOkBTN:"OK",customClearBTN:datapickerLang[$lang].customClearBTN,customCancelBTN:datapickerLang[$lang].customCancelBTN,firstWeekday:datapickerLang[$lang].firstWeekday,dateFormat:"DD.MM.YYYY",customWeekDays:datapickerLang[$lang].customWeekDays,customMonths:datapickerLang[$lang].customMonths,selectedDate:$selectedDate==="Invalid Date"?new Date:$selectedDate,minDate:nextDay,maxDate:limitDay})});document.querySelector("[data-latitude]").value="";document.querySelector("[data-longitude]").value="";let dataUserAddress=document.querySelectorAll("[data-address]");if(dataUserAddress){dataUserAddress.forEach(function(area){area.value=""})}limitOxMvRIBczY=100;setTimeout(function OxMvRIBczY(){if(typeof initAdddress=="function"){initAdddress();return}if(limitOxMvRIBczY>1e3){return}limitOxMvRIBczY=limitOxMvRIBczY*2;setTimeout(OxMvRIBczY,limitOxMvRIBczY)},100)}});return false}async function submitRegionForm(forms,id){const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var doc=parser.parseFromString(data,"text/html");let callId=id.replace(/_region/g,"_call");let call=doc.getElementById(callId);document.getElementById(callId).replaceWith(call);document.querySelector("[data-latitude]").value="";document.querySelector("[data-longitude]").value="";limitZJzxDhmvtC=100;setTimeout(function ZJzxDhmvtC(){if(typeof initAdddress=="function"){initAdddress();return}if(limitZJzxDhmvtC>1e3){return}limitZJzxDhmvtC=limitZJzxDhmvtC*2;setTimeout(ZJzxDhmvtC,limitZJzxDhmvtC)},100)}});return false}async function submitPaymentForm(forms){const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var doc=parser.parseFromString(data,"text/html");let user_payment=doc.getElementById("user_payment");document.getElementById("user_payment").replaceWith(user_payment);document.querySelectorAll('input[name="new_order_form[usr][payment][payment]"]').forEach(function(user_payment){user_payment.addEventListener("change",function(event){let forms=this.closest("form");submitPaymentForm(forms);return false})});var tooltipTriggerList=[].slice.call(user_payment.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)})}});return false}async function submitProfileForm(forms){const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var doc=parser.parseFromString(data,"text/html");let user_profile=doc.getElementById("user_profile");document.getElementById("user_profile").replaceWith(user_profile);userProfileType=document.getElementById("new_order_form_usr_userProfile_type");userProfileType.addEventListener("change",function(event){let forms=this.closest("form");submitProfileForm(forms);return false});let user_payment=doc.getElementById("user_payment");document.getElementById("user_payment").replaceWith(user_payment);document.querySelectorAll('input[name="new_order_form[usr][payment][payment]"]').forEach(function(userPayment){userPayment.addEventListener("change",function(event){let replaceId="user_profile";let forms=this.closest("form");submitPaymentForm(forms);return false})});let user_delivery=doc.getElementById("user_delivery");document.getElementById("user_delivery").replaceWith(user_delivery);document.querySelectorAll('input[name="new_order_form[usr][delivery][delivery]"]').forEach(function(user_delivery){user_delivery.addEventListener("change",function(event){let forms=this.closest("form");submitDeliveryForm(forms);return false})});document.querySelectorAll("select.change_region_field").forEach(function(userRegion){userRegion.addEventListener("change",function(event){let forms=this.closest("form");submitRegionForm(forms,userRegion.id);return false})});var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)});document.querySelectorAll(".js-datepicker").forEach(datepicker=>{let $elementDate=document.getElementById(datepicker.id).value;const[day,month,year]=$elementDate.split(".");$selectedDate=new Date(+year,month-1,+day);let currentDate=new Date;let nextDay=new Date(currentDate.setDate(currentDate.getDate()+1));currentDate=new Date;let limitDay=new Date(currentDate.setDate(currentDate.getDate()+7));MCDatepicker.create({el:"#"+datepicker.id,bodyType:"modal",autoClose:false,closeOndblclick:true,closeOnBlur:false,customOkBTN:"OK",customClearBTN:datapickerLang[$lang].customClearBTN,customCancelBTN:datapickerLang[$lang].customCancelBTN,firstWeekday:datapickerLang[$lang].firstWeekday,dateFormat:"DD.MM.YYYY",customWeekDays:datapickerLang[$lang].customWeekDays,customMonths:datapickerLang[$lang].customMonths,selectedDate:$selectedDate==="Invalid Date"?nextDay:$selectedDate,minDate:nextDay,maxDate:limitDay})})}});return false}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initFormDraft)}else{initFormDraft()}function initFormDraft(){let form=document.querySelector("#modal form");if(typeof form=="undefined"||!form){return}let name=form.name;input=form.querySelector("#"+name+"_price_total");if(input){input.addEventListener("input",orderModalCounter.debounce(300));form.querySelector("#plus").addEventListener("click",()=>{let price_total=form.querySelector("#"+name+"_price_total");let result=price_total.value*1;let max=price_total.dataset.max*1;if(result<max){result=result+1;form.querySelector("#"+name+"_price_total").value=result;orderModalSum(result)}});form.querySelector("#minus").addEventListener("click",()=>{let price_total=form.querySelector("#"+name+"_price_total");let result=price_total.value*1;if(result>1){result=result-1;form.querySelector("#"+name+"_price_total").value=result;orderModalSum(result)}})}function orderModalCounter(){console.log(this);let result=this.value*1;let max=this.dataset.max*1;if(result>max){form.querySelector("#"+name+"_price_total").value=max;form.querySelector("#summ_"+name+"_price_total").value=max;result=max}orderModalSum(result)}function orderModalSum(result){let product_summ=form.querySelector("#summ_"+name+"_price_total");let result_product_sum=result*product_summ.dataset.price;if(product_summ.dataset.discount){result_product_sum=result_product_sum-result_product_sum/100*product_summ.dataset.discount}if(product_summ.dataset.currency){result_product_sum=result_product_sum/100;result_product_sum=new Intl.NumberFormat($lang,{style:"currency",currency:product_summ.dataset.currency,maximumFractionDigits:0}).format(result_product_sum);product_summ.innerText=result_product_sum}}}